---
description: 
globs: 
alwaysApply: true
---
---
description: Global Project Rules for â€œBabyâ€‘English MVPâ€
alwaysApply: true           # Cursor will attach this to every context
globs:
  - "**/*.{ts,tsx,md,mdx}"
  - "apps/edge/**/*.ts"
  - "supabase/migrations/**/*.sql"
---

# ğŸ“š Coding Standards
1. **TypeScript strict** â€• `noImplicitAny`, `exactOptionalPropertyTypes` ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã€‚  
2. **Imports**  
   - React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ **named export** (`export function ScreenName()`) ã‚’æ¨å¥¨ã€‚  
   - ã‚µã‚¤ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ä¼´ã† import ã¯ `apps/mobile/src/bootstrap.ts` ã«é›†ç´„ã€‚  
3. **Runtime Validation** â€• å¤–éƒ¨å…¥åŠ›ï¼ˆLLM è¿”å´å«ã‚€ï¼‰ã¯ *å¿…ãš* **Zod** ã§æ¤œè¨¼ã—ã€  
   `Infer<typeof schema>` å‹ã‚’ export ã—ã¦å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰å†åˆ©ç”¨ã™ã‚‹ã€‚  
4. **Styling** â€• UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ **Tamagui**ã€‚Tailwind ã‚¯ãƒ©ã‚¹ã¯ä½¿ç”¨ã—ãªã„ã€‚  
5. **Edge Functions** â€• Deno ãƒ©ãƒ³ã‚¿ã‚¤ãƒ é™å®šã€‚Node API (`fs`, `path`) ã‚’ç›´æ¥åˆ©ç”¨ã—ãªã„ã€‚

# ğŸ—ï¸ Architectural Rules
- **Data Fetching** ã¯ã™ã¹ã¦ `@shared/api.ts` (TanStack Query ãƒ©ãƒƒãƒ‘) çµŒç”±ã€‚  
- **Reactive State** ã¯ **Zustand**ã€‚Reduxï¼MobX ã‚’å°å…¥ã—ãªã„ã€‚  
- **Navigation** ã¯ **Expo Router** ã‚’ä½¿ç”¨ã—ã€Stackâ€†+â€†Tabs ã‚’ `/app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã§è¡¨ç¾ã€‚  
- **Word Gatekeeper** ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã€CEFR èªå½™ãƒªã‚¹ãƒˆã®å˜ä¸€ã‚½ãƒ¼ã‚¹  
  `/packages/shared/wordlists.ts` ã‚’å¿…ãšæ›´æ–°ã—ã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã€‚  
- **LLM å‘¼ã³å‡ºã—** ã¯ `OpenAI ChatCompletion` ã‚ã‚‹ã„ã¯ `Responses API` ã®ã¿ã€‚  
  ä»–ç¤¾ LLM ã‚’è¿½åŠ ã™ã‚‹éš›ã¯ `docs/llm-rationale.md` ã«æ¯”è¼ƒæ¤œè¨¼ã‚’æ›¸ãã€ãƒ¬ãƒ“ãƒ¥ã‚¢åˆæ„ã‚’å¾—ã‚‹ã€‚  

# ğŸ§ª Testing
- **Unit** â€• Vitestã€`*.test.ts[x]` ã‚’ã‚½ãƒ¼ã‚¹éš£æ¥ã§é…ç½®ã€‚  
- **E2E** â€• Playwrightã€‚main ãƒ–ãƒ©ãƒ³ãƒã® GH Action ã§ `pnpm e2e:ci` ã‚’å®Ÿè¡Œã€‚  
- **Coverage** â€• é–¾å€¤ 80â€¯%ä»¥ä¸Šã€‚Edge Function ã¯ `supabase test` ã§æœ€ä½ 1 ã‚±ãƒ¼ã‚¹ã€‚  

# ğŸ”€ Git Workflow
| ãƒ–ãƒ©ãƒ³ãƒç¨®åˆ¥ | å‘½å | ãƒãƒ¼ã‚¸æ–¹æ³• |
|--------------|------|------------|
| Feature      | `feat/<topic>` | Squash & Merge |
| Fix          | `fix/<topic>`  | Squash & Merge |
| Chore/Docs   | `chore/<topic>` `docs/<topic>` | Rebase Merge |
| Release      | `release/*`    | Merge Commit |

- **Commit** ã¯ Conventional Commitsã€‚ä¾‹ï¼š`feat(chat): add scorer util`  
- **PR ãƒ†ãƒ³ãƒ—ãƒ¬** ã‚’å¿…ãšè¨˜å…¥ã—ã€`pnpm lint && pnpm test` ãŒé€šã‚‹ã“ã¨ã€‚  
- `main` ã¸ã®ç›´æ¥ push ã¯ç¦æ­¢ (`branch protection` æœ‰åŠ¹)ã€‚  

# âš™ï¸ Scripts & Automation
```jsonc
// package.json@root (æŠœç²‹)
{
  "scripts": {
    "dev": "concurrently -k \"supabase functions serve --env-file ./.env.local --no-verify-jwt\" \"pnpm --filter apps/mobile expo start\"",
    "lint": "eslint \"{apps,packages}/**/*.{ts,tsx}\"",
    "test": "vitest",
    "e2e:ci": "playwright test --reporter=dot"
  }
}
```

* **CI** (GitHub Actions) ã¯ä¸Šè¨˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é †ã«å®Ÿè¡Œã—ã€EAS ãƒ“ãƒ«ãƒ‰ (`eas build --profile preview`) æˆåŠŸã§ passã€‚

# ğŸª„ Devin / Cursor Instructions

* Use `pnpm dev` to spin up both **Expo** and **Supabase Edge** locally.
* Before generating code, load this rule file to ensure context; verify with `cursor rules` command.
* Whenever creating a new file, check if an existing shared util covers the need. If not, place common code in `packages/shared`.
* After each code generation, run `pnpm lint --fix` automatically.

# âœ… Definition of Done

1. Tests & Lint pass (CI green).
2. New/updated API types added to `packages/shared/schema.d.ts`.
3. Cursor comment `@done` at bottom of PR description.
